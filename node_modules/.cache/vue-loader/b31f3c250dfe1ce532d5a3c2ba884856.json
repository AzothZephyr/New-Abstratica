{"remainingRequest":"/Users/aaronh/Downloads/abstratica-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/aaronh/Downloads/abstratica-web/src/components/ArtPreview.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/aaronh/Downloads/abstratica-web/src/components/ArtPreview.vue","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/cache-loader/dist/cjs.js","mtime":1693191335836},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/babel-loader/lib/index.js","mtime":1693191336222},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/cache-loader/dist/cjs.js","mtime":1693191335836},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/vue-loader/lib/index.js","mtime":1693191336374}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS92dWV0aWZ5anMvdnVldGlmeS9pc3N1ZXMvNDk4MyNpc3N1ZWNvbW1lbnQtNDc3NDQyMDUwCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IHNsZWVwIH0gZnJvbSAiLi4vbGliL3V0aWwiOwppbXBvcnQgcmV0cnkgZnJvbSAiYXN5bmMtcmV0cnkiOwppbXBvcnQgeyBtYXBNdXRhdGlvbnMgfSBmcm9tICJ2dWV4IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgc3JjOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAogICAgbmFtZTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKICAgIG1pbnQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlOiB0cnVlLAogICAgfSwKICAgIG1ldGFkYXRhOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgcmVxdWlyZTogdHJ1ZSwKICAgIH0sCiAgICBpc05ldzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgIH0sCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5vYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcigoZW50cmllcykgPT4gewogICAgICBjb25zdCBpbWFnZSA9IGVudHJpZXNbMF07CiAgICAgIGlmIChpbWFnZS5pc0ludGVyc2VjdGluZykgewogICAgICAgIHRoaXMuaW50ZXJzZWN0ZWQgPSB0cnVlOwogICAgICAgIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICB9CiAgICB9KTsKCiAgICB0aGlzLm9ic2VydmVyLm9ic2VydmUodGhpcy4kZWwpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGludGVyc2VjdGVkOiBhc3luYyBmdW5jdGlvbiAobmV3VmFsdWUpIHsKICAgICAgaWYgKCF0aGlzLmVyYyAmJiBuZXdWYWx1ZSAmJiAhdGhpcy5sb2FkaW5nRXJjKSB7CiAgICAgICAgLy8gcHJldmVudCBtdWx0aXBsZSBjYWxscwogICAgICAgIHRoaXMubG9hZGluZ0VyYyA9IHRydWU7CiAgICAgICAgdGhpcy5lcmMgPSBhd2FpdCB0aGlzLnRyeUdldEVyY0Zyb21DYWNoZSh0aGlzLnNyYyk7CiAgICAgICAgLy8gc2xvdyBkb3duIGEgYml0IHRvIGF2b2lkIDUwMAogICAgICAgIGF3YWl0IHNsZWVwKDEwMDApOwogICAgICAgIHRoaXMucmVhZHkgPSB0cnVlOwogICAgICB9CiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmdFcmM6IGZhbHNlLAogICAgICBsb2FkZWQ6IGZhbHNlLAogICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgaW50ZXJzZWN0ZWQ6IGZhbHNlLAogICAgICBlcmM6IG51bGwsCiAgICAgIHJlYWR5OiBmYWxzZSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgc3JjVXJsKCkgewogICAgICByZXR1cm4gdGhpcy5yZWFkeSA/IHRoaXMuZXJjPy5pbWFnZSA6ICIiOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIC4uLm1hcE11dGF0aW9ucyhbInJlbW92ZU5ld01ldGEiXSksCiAgICBhc3luYyB0cnlHZXRFcmNGcm9tQ2FjaGUoc3JjKSB7CiAgICAgIGNvbnN0IGlkID0gc3JjLnN1YnN0cmluZyhzcmMubGFzdEluZGV4T2YoIi8iKSArIDEpOwogICAgICBjb25zdCBlcmMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShpZCk7CiAgICAgIGlmIChlcmMpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiZm91bmQgZnJvbSBjYWNoZSIpOwogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGVyYyk7CiAgICAgIH0KICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCByZXRyeSgKICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICByZXR1cm4gYXdhaXQgYXhpb3MuZ2V0KHNyYyk7CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBtaW5UaW1lb3V0OiA1MDAsCiAgICAgICAgICBmYWN0b3I6IDEuNSwKICAgICAgICAgIG9uUmV0cnk6ICgpID0+IHsKICAgICAgICAgICAgLy8gbG9nZ2VyLmxvZ0Vycm9yKGUsIGBgKTsKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICApOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShpZCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0sCiAgICBvbkRldGFpbENsaWNrZWQoKSB7CiAgICAgIGlmICghdGhpcy5sb2FkZWQpIHJldHVybjsKICAgICAgaWYgKHRoaXMuaXNOZXcpIHsKICAgICAgICB0aGlzLnJlbW92ZU5ld01ldGEodGhpcy5tZXRhZGF0YSk7CiAgICAgIH0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICJORlREZXRhaWwiLAogICAgICAgIHBhcmFtczogeyBtZXRhZGF0YTogdGhpcy5tZXRhZGF0YSB9LAogICAgICB9KTsKICAgIH0sCiAgICBvbkxvYWRlZCgpIHsKICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlOwogICAgfSwKICAgIG9uRXJyb3IoKSB7CiAgICAgIC8vIHJlbG9hZAogICAgICB0aGlzLnJlYWR5ID0gZmFsc2U7CiAgICAgIHRoaXMucmVhZHkgPSB0cnVlOwogICAgfSwKICAgIGNhbGN1bGF0ZUltZ0hlaWdodCgpIHsKICAgICAgaWYgKHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC53aWR0aCA8IDQwMCkgcmV0dXJuICIzNTBweCI7CiAgICAgIHN3aXRjaCAodGhpcy4kdnVldGlmeS5icmVha3BvaW50Lm5hbWUpIHsKICAgICAgICBjYXNlICJ4cyI6CiAgICAgICAgICByZXR1cm4gIjQ1MHB4IjsKICAgICAgICBjYXNlICJzbSI6CiAgICAgICAgICByZXR1cm4gIjQ1MHB4IjsKICAgICAgICBjYXNlICJtZCI6CiAgICAgICAgICByZXR1cm4gIjMwMHB4IjsKICAgICAgICBjYXNlICJsZyI6CiAgICAgICAgICByZXR1cm4gIjMwMHB4IjsKICAgICAgICBjYXNlICJ4bCI6CiAgICAgICAgICByZXR1cm4gIjMwMHB4IjsKICAgICAgfQogICAgICByZXR1cm4gIjUwMHB4IjsKICAgIH0sCiAgfSwKICBkZXN0cm95ZWQoKSB7CiAgICB0aGlzLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICB9LAp9Owo="},{"version":3,"sources":["ArtPreview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ArtPreview.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <v-card elevation=\"4\" outlined class=\"ma-0 ma-md-1 ma-lg-1 ma-xl-1\">\n    <v-img\n      :src=\"srcUrl\"\n      aspect-ratio=\"1\"\n      @load=\"onLoaded\"\n      @error=\"onError\"\n      @click=\"onDetailClicked\"\n      class=\"white--text align-end cursor\"\n      :gradient=\"loaded ? 'to bottom, rgba(0,0,0,0) 80%, rgba(0,0,0,.6)' : ''\"\n    >\n      <template v-slot:placeholder>\n        <v-row\n          class=\"fill-height ma-0 grey lighten-4\"\n          align=\"center\"\n          justify=\"center\"\n        >\n          <v-progress-circular\n            indeterminate\n            color=\"grey lighten-1\"\n          ></v-progress-circular>\n        </v-row>\n      </template>\n      <v-card-title v-show=\"loaded\" class=\"pb-5 pb-sm-3 pb-md-3\">\n        {{ name }}\n        <v-chip\n          v-show=\"isNew\"\n          label\n          color=\"yellow\"\n          class=\"ma-1 ml-2\"\n          x-small\n          :ripple=\"false\"\n          >New</v-chip\n        >\n      </v-card-title>\n    </v-img>\n  </v-card>\n</template>\n\n<script>\n// https://github.com/vuetifyjs/vuetify/issues/4983#issuecomment-477442050\nimport axios from \"axios\";\nimport { sleep } from \"../lib/util\";\nimport retry from \"async-retry\";\nimport { mapMutations } from \"vuex\";\n\nexport default {\n  props: {\n    src: {\n      type: String,\n      required: true,\n    },\n    name: {\n      type: String,\n      required: true,\n    },\n    mint: {\n      type: String,\n      require: true,\n    },\n    metadata: {\n      type: String,\n      require: true,\n    },\n    isNew: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  mounted() {\n    this.observer = new IntersectionObserver((entries) => {\n      const image = entries[0];\n      if (image.isIntersecting) {\n        this.intersected = true;\n        this.observer.disconnect();\n      }\n    });\n\n    this.observer.observe(this.$el);\n  },\n  watch: {\n    intersected: async function (newValue) {\n      if (!this.erc && newValue && !this.loadingErc) {\n        // prevent multiple calls\n        this.loadingErc = true;\n        this.erc = await this.tryGetErcFromCache(this.src);\n        // slow down a bit to avoid 500\n        await sleep(1000);\n        this.ready = true;\n      }\n    },\n  },\n  data() {\n    return {\n      loadingErc: false,\n      loaded: false,\n      observer: null,\n      intersected: false,\n      erc: null,\n      ready: false,\n    };\n  },\n  computed: {\n    srcUrl() {\n      return this.ready ? this.erc?.image : \"\";\n    },\n  },\n  methods: {\n    ...mapMutations([\"removeNewMeta\"]),\n    async tryGetErcFromCache(src) {\n      const id = src.substring(src.lastIndexOf(\"/\") + 1);\n      const erc = localStorage.getItem(id);\n      if (erc) {\n        // console.log(\"found from cache\");\n        return JSON.parse(erc);\n      }\n      const { data } = await retry(\n        async () => {\n          return await axios.get(src);\n        },\n        {\n          minTimeout: 500,\n          factor: 1.5,\n          onRetry: () => {\n            // logger.logError(e, ``);\n          },\n        }\n      );\n      localStorage.setItem(id, JSON.stringify(data));\n      return data;\n    },\n    onDetailClicked() {\n      if (!this.loaded) return;\n      if (this.isNew) {\n        this.removeNewMeta(this.metadata);\n      }\n      this.$router.push({\n        name: \"NFTDetail\",\n        params: { metadata: this.metadata },\n      });\n    },\n    onLoaded() {\n      this.loaded = true;\n    },\n    onError() {\n      // reload\n      this.ready = false;\n      this.ready = true;\n    },\n    calculateImgHeight() {\n      if (this.$vuetify.breakpoint.width < 400) return \"350px\";\n      switch (this.$vuetify.breakpoint.name) {\n        case \"xs\":\n          return \"450px\";\n        case \"sm\":\n          return \"450px\";\n        case \"md\":\n          return \"300px\";\n        case \"lg\":\n          return \"300px\";\n        case \"xl\":\n          return \"300px\";\n      }\n      return \"500px\";\n    },\n  },\n  destroyed() {\n    this.observer.disconnect();\n  },\n};\n</script>\n<style scoped lang=\"scss\">\n@import \"../scss/global.scss\";\n\n.cursor {\n  cursor: pointer;\n}\n</style>\n"]}]}
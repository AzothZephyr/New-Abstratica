{"remainingRequest":"/Users/aaronh/Downloads/abstratica-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/aaronh/Downloads/abstratica-web/src/components/ArtPreview.vue?vue&type=style&index=0&id=137fbb95&scoped=true&lang=scss&","dependencies":[{"path":"/Users/aaronh/Downloads/abstratica-web/src/components/ArtPreview.vue","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/css-loader/dist/cjs.js","mtime":1693191336063},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1693191336554},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/postcss-loader/src/index.js","mtime":1693191336210},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/sass-loader/dist/cjs.js","mtime":1693191335793},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/cache-loader/dist/cjs.js","mtime":1693191335836},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/vue-loader/lib/index.js","mtime":1693191336374}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIi4uL3Njc3MvZ2xvYmFsLnNjc3MiOwoKLmN1cnNvciB7CiAgY3Vyc29yOiBwb2ludGVyOwp9Cg=="},{"version":3,"sources":["ArtPreview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4KA;;AAEA;AACA;AACA","file":"ArtPreview.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <v-card elevation=\"4\" outlined class=\"ma-0 ma-md-1 ma-lg-1 ma-xl-1\">\n    <v-img\n      :src=\"srcUrl\"\n      aspect-ratio=\"1\"\n      @load=\"onLoaded\"\n      @error=\"onError\"\n      @click=\"onDetailClicked\"\n      class=\"white--text align-end cursor\"\n      :gradient=\"loaded ? 'to bottom, rgba(0,0,0,0) 80%, rgba(0,0,0,.6)' : ''\"\n    >\n      <template v-slot:placeholder>\n        <v-row\n          class=\"fill-height ma-0 grey lighten-4\"\n          align=\"center\"\n          justify=\"center\"\n        >\n          <v-progress-circular\n            indeterminate\n            color=\"grey lighten-1\"\n          ></v-progress-circular>\n        </v-row>\n      </template>\n      <v-card-title v-show=\"loaded\" class=\"pb-5 pb-sm-3 pb-md-3\">\n        {{ name }}\n        <v-chip\n          v-show=\"isNew\"\n          label\n          color=\"yellow\"\n          class=\"ma-1 ml-2\"\n          x-small\n          :ripple=\"false\"\n          >New</v-chip\n        >\n      </v-card-title>\n    </v-img>\n  </v-card>\n</template>\n\n<script>\n// https://github.com/vuetifyjs/vuetify/issues/4983#issuecomment-477442050\nimport axios from \"axios\";\nimport { sleep } from \"../lib/util\";\nimport retry from \"async-retry\";\nimport { mapMutations } from \"vuex\";\n\nexport default {\n  props: {\n    src: {\n      type: String,\n      required: true,\n    },\n    name: {\n      type: String,\n      required: true,\n    },\n    mint: {\n      type: String,\n      require: true,\n    },\n    metadata: {\n      type: String,\n      require: true,\n    },\n    isNew: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  mounted() {\n    this.observer = new IntersectionObserver((entries) => {\n      const image = entries[0];\n      if (image.isIntersecting) {\n        this.intersected = true;\n        this.observer.disconnect();\n      }\n    });\n\n    this.observer.observe(this.$el);\n  },\n  watch: {\n    intersected: async function (newValue) {\n      if (!this.erc && newValue && !this.loadingErc) {\n        // prevent multiple calls\n        this.loadingErc = true;\n        this.erc = await this.tryGetErcFromCache(this.src);\n        // slow down a bit to avoid 500\n        await sleep(1000);\n        this.ready = true;\n      }\n    },\n  },\n  data() {\n    return {\n      loadingErc: false,\n      loaded: false,\n      observer: null,\n      intersected: false,\n      erc: null,\n      ready: false,\n    };\n  },\n  computed: {\n    srcUrl() {\n      return this.ready ? this.erc?.image : \"\";\n    },\n  },\n  methods: {\n    ...mapMutations([\"removeNewMeta\"]),\n    async tryGetErcFromCache(src) {\n      const id = src.substring(src.lastIndexOf(\"/\") + 1);\n      const erc = localStorage.getItem(id);\n      if (erc) {\n        // console.log(\"found from cache\");\n        return JSON.parse(erc);\n      }\n      const { data } = await retry(\n        async () => {\n          return await axios.get(src);\n        },\n        {\n          minTimeout: 500,\n          factor: 1.5,\n          onRetry: () => {\n            // logger.logError(e, ``);\n          },\n        }\n      );\n      localStorage.setItem(id, JSON.stringify(data));\n      return data;\n    },\n    onDetailClicked() {\n      if (!this.loaded) return;\n      if (this.isNew) {\n        this.removeNewMeta(this.metadata);\n      }\n      this.$router.push({\n        name: \"NFTDetail\",\n        params: { metadata: this.metadata },\n      });\n    },\n    onLoaded() {\n      this.loaded = true;\n    },\n    onError() {\n      // reload\n      this.ready = false;\n      this.ready = true;\n    },\n    calculateImgHeight() {\n      if (this.$vuetify.breakpoint.width < 400) return \"350px\";\n      switch (this.$vuetify.breakpoint.name) {\n        case \"xs\":\n          return \"450px\";\n        case \"sm\":\n          return \"450px\";\n        case \"md\":\n          return \"300px\";\n        case \"lg\":\n          return \"300px\";\n        case \"xl\":\n          return \"300px\";\n      }\n      return \"500px\";\n    },\n  },\n  destroyed() {\n    this.observer.disconnect();\n  },\n};\n</script>\n<style scoped lang=\"scss\">\n@import \"../scss/global.scss\";\n\n.cursor {\n  cursor: pointer;\n}\n</style>\n"]}]}
{"remainingRequest":"/Users/aaronh/Downloads/abstratica-web/node_modules/babel-loader/lib/index.js!/Users/aaronh/Downloads/abstratica-web/node_modules/eslint-loader/index.js??ref--14-0!/Users/aaronh/Downloads/abstratica-web/src/lib/name-service.js","dependencies":[{"path":"/Users/aaronh/Downloads/abstratica-web/src/lib/name-service.js","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/babel.config.js","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/cache-loader/dist/cjs.js","mtime":1693191335836},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/babel-loader/lib/index.js","mtime":1693191336222},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/eslint-loader/index.js","mtime":1693191335906}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9Vc2Vycy9hYXJvbmgvRG93bmxvYWRzL2Fic3RyYXRpY2Etd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5LmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9hYXJvbmgvRG93bmxvYWRzL2Fic3RyYXRpY2Etd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0IHsgbmV0d29ya0Nvbm5lY3Rpb24gfSBmcm9tICIuL2Nvbm5lY3Rpb24iOwppbXBvcnQgeyBQdWJsaWNLZXkgfSBmcm9tICJAc29sYW5hL3dlYjMuanMiOwppbXBvcnQgQk4gZnJvbSAiYm4uanMiOwppbXBvcnQgeyBnZXRIYW5kbGVBbmRSZWdpc3RyeUtleSwgZ2V0SGFzaGVkTmFtZSwgZ2V0TmFtZUFjY291bnRLZXksIE5hbWVSZWdpc3RyeVN0YXRlLCBOQU1FX1BST0dSQU1fSUQsIGdldEZpbHRlcmVkUHJvZ3JhbUFjY291bnRzIH0gZnJvbSAiQHNvbGFuYS9zcGwtbmFtZS1zZXJ2aWNlIjsKZXhwb3J0IHZhciBTb2xEb21haW5FeHRlbnRpb24gPSAic29sIjsgLy8gQWRkcmVzcyBvZiB0aGUgU09MIFRMRAoKZXhwb3J0IHZhciBTT0xfVExEX0FVVEhPUklUWSA9IG5ldyBQdWJsaWNLZXkoIjU4UHd0alNEdUZIdVVrWWpIOUJZbm5RS0hmd285cmVaaEMyek1KdjlKUGt4Iik7CmV4cG9ydCB2YXIgUFJPR1JBTV9JRCA9IG5ldyBQdWJsaWNLZXkoImpDZWJOMzRiVWZkZVVZSlQxM0oxeUcxNlhXUXB0NVBEeDZNc2U5R1VxaFIiKTsKZXhwb3J0IGZ1bmN0aW9uIGdldEFsbFJlZ2lzdGVyZWRJbmZvKF94KSB7CiAgcmV0dXJuIF9nZXRBbGxSZWdpc3RlcmVkSW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfZ2V0QWxsUmVnaXN0ZXJlZEluZm8oKSB7CiAgX2dldEFsbFJlZ2lzdGVyZWRJbmZvID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHdhbGxldCkgewogICAgdmFyIHR3aXR0ZXJPbmx5LAogICAgICAgIF9hcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0d2l0dGVyT25seSA9IF9hcmdzLmxlbmd0aCA+IDEgJiYgX2FyZ3NbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzFdIDogZmFsc2U7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gZ2V0VHdpdHRlckhhbmRsZSh3YWxsZXQpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgaWYgKCF0d2l0dGVyT25seSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dC50MSA9IG51bGw7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgIHJldHVybiBnZXRVc2VyRG9tYWlucyh3YWxsZXQpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIF9jb250ZXh0LnQxID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBfY29udGV4dC50MiA9IF9jb250ZXh0LnQxOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgdHdpdHRlcjogX2NvbnRleHQudDAsCiAgICAgICAgICAgICAgZG9tYWluOiBfY29udGV4dC50MgogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKICByZXR1cm4gX2dldEFsbFJlZ2lzdGVyZWRJbmZvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRUd2l0dGVySGFuZGxlKF94MikgewogIHJldHVybiBfZ2V0VHdpdHRlckhhbmRsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfZ2V0VHdpdHRlckhhbmRsZSgpIHsKICBfZ2V0VHdpdHRlckhhbmRsZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIod2FsbGV0KSB7CiAgICB2YXIgd2FsbGV0S2V5LCByZWc7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgIHdhbGxldEtleSA9IG5ldyBQdWJsaWNLZXkod2FsbGV0KTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICByZXR1cm4gZ2V0SGFuZGxlQW5kUmVnaXN0cnlLZXkobmV0d29ya0Nvbm5lY3Rpb24sIHdhbGxldEtleSk7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICByZWcgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgIGlmIChyZWcpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCAiIi5jb25jYXQocmVnWzBdKSk7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxMDsKICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwoKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1swLCAxMF1dKTsKICB9KSk7CiAgcmV0dXJuIF9nZXRUd2l0dGVySGFuZGxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyRG9tYWlucyhfeDMpIHsKICByZXR1cm4gX2dldFVzZXJEb21haW5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9nZXRVc2VyRG9tYWlucygpIHsKICBfZ2V0VXNlckRvbWFpbnMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHdhbGxldCkgewogICAgdmFyIHdhbGxldEtleSwgZG9tYWlucywgbmFtZTsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMDsKICAgICAgICAgICAgd2FsbGV0S2V5ID0gbmV3IFB1YmxpY0tleSh3YWxsZXQpOwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiBmaW5kT3duZWROYW1lQWNjb3VudHNGb3JVc2VyKHdhbGxldEtleSk7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBkb21haW5zID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICBpZiAoISghZG9tYWlucyB8fCBkb21haW5zLmxlbmd0aCA9PSAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA5OwogICAgICAgICAgICByZXR1cm4gcGVyZm9ybVJldmVyc2VMb29rdXAobmV0d29ya0Nvbm5lY3Rpb24sIGRvbWFpbnNbMF0pOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgbmFtZSA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgaWYgKG5hbWUpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsICIiLmNvbmNhdChuYW1lLCAiLiIpLmNvbmNhdChTb2xEb21haW5FeHRlbnRpb24pKTsKCiAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDE1OwogICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMCk7CgogICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUzLCBudWxsLCBbWzAsIDE1XV0pOwogIH0pKTsKICByZXR1cm4gX2dldFVzZXJEb21haW5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBwZXJmb3JtUmV2ZXJzZUxvb2t1cChfeDQsIF94NSkgewogIHJldHVybiBfcGVyZm9ybVJldmVyc2VMb29rdXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3BlcmZvcm1SZXZlcnNlTG9va3VwKCkgewogIF9wZXJmb3JtUmV2ZXJzZUxvb2t1cCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoY29ubmVjdGlvbiwgbmFtZUFjY291bnQpIHsKICAgIHZhciBfeWllbGQkUHVibGljS2V5JGZpbmQsIF95aWVsZCRQdWJsaWNLZXkkZmluZDIsIGNlbnRyYWxTdGF0ZSwgaGFzaGVkUmV2ZXJzZUxvb2t1cCwgcmV2ZXJzZUxvb2t1cEFjY291bnQsIG5hbWUsIG5hbWVMZW5ndGg7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOwogICAgICAgICAgICByZXR1cm4gUHVibGljS2V5LmZpbmRQcm9ncmFtQWRkcmVzcyhbUFJPR1JBTV9JRC50b0J1ZmZlcigpXSwgUFJPR1JBTV9JRCk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBfeWllbGQkUHVibGljS2V5JGZpbmQgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgX3lpZWxkJFB1YmxpY0tleSRmaW5kMiA9IF9zbGljZWRUb0FycmF5KF95aWVsZCRQdWJsaWNLZXkkZmluZCwgMSk7CiAgICAgICAgICAgIGNlbnRyYWxTdGF0ZSA9IF95aWVsZCRQdWJsaWNLZXkkZmluZDJbMF07CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgcmV0dXJuIGdldEhhc2hlZE5hbWUobmFtZUFjY291bnQudG9CYXNlNTgoKSk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBoYXNoZWRSZXZlcnNlTG9va3VwID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgIHJldHVybiBnZXROYW1lQWNjb3VudEtleShoYXNoZWRSZXZlcnNlTG9va3VwLCBjZW50cmFsU3RhdGUpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIHJldmVyc2VMb29rdXBBY2NvdW50ID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBOYW1lUmVnaXN0cnlTdGF0ZS5yZXRyaWV2ZShjb25uZWN0aW9uLCByZXZlcnNlTG9va3VwQWNjb3VudCk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgbmFtZSA9IF9jb250ZXh0NC5zZW50OwoKICAgICAgICAgICAgaWYgKG5hbWUuZGF0YSkgewogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IHJldHJpZXZlIG5hbWUgZGF0YSIpOwoKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgIG5hbWVMZW5ndGggPSBuZXcgQk4obmFtZS5kYXRhLnNsaWNlKDAsIDQpLCAibGUiKS50b051bWJlcigpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbmFtZS5kYXRhLnNsaWNlKDQsIDQgKyBuYW1lTGVuZ3RoKS50b1N0cmluZygpKTsKCiAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNCk7CiAgfSkpOwogIHJldHVybiBfcGVyZm9ybVJldmVyc2VMb29rdXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gZmluZE93bmVkTmFtZUFjY291bnRzRm9yVXNlcihfeDYpIHsKICByZXR1cm4gX2ZpbmRPd25lZE5hbWVBY2NvdW50c0ZvclVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX2ZpbmRPd25lZE5hbWVBY2NvdW50c0ZvclVzZXIoKSB7CiAgX2ZpbmRPd25lZE5hbWVBY2NvdW50c0ZvclVzZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KHVzZXJBY2NvdW50KSB7CiAgICB2YXIgZmlsdGVycywgYWNjb3VudHM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBmaWx0ZXJzID0gW3sKICAgICAgICAgICAgICBtZW1jbXA6IHsKICAgICAgICAgICAgICAgIG9mZnNldDogMzIsCiAgICAgICAgICAgICAgICBieXRlczogdXNlckFjY291bnQudG9CYXNlNTgoKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV07CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGdldEZpbHRlcmVkUHJvZ3JhbUFjY291bnRzKG5ldHdvcmtDb25uZWN0aW9uLCBOQU1FX1BST0dSQU1fSUQsIGZpbHRlcnMpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgYWNjb3VudHMgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGFjY291bnRzLm1hcChmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiBhLnB1YmxpY0tleTsKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTUpOwogIH0pKTsKICByZXR1cm4gX2ZpbmRPd25lZE5hbWVBY2NvdW50c0ZvclVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQ=="},{"version":3,"sources":["/Users/aaronh/Downloads/abstratica-web/src/lib/name-service.js"],"names":["networkConnection","PublicKey","BN","getHandleAndRegistryKey","getHashedName","getNameAccountKey","NameRegistryState","NAME_PROGRAM_ID","getFilteredProgramAccounts","SolDomainExtention","SOL_TLD_AUTHORITY","PROGRAM_ID","getAllRegisteredInfo","wallet","twitterOnly","getTwitterHandle","getUserDomains","twitter","domain","walletKey","reg","findOwnedNameAccountsForUser","domains","length","performReverseLookup","name","connection","nameAccount","findProgramAddress","toBuffer","centralState","toBase58","hashedReverseLookup","reverseLookupAccount","retrieve","data","Error","nameLength","slice","toNumber","toString","userAccount","filters","memcmp","offset","bytes","accounts","map","a","publicKey"],"mappings":"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","sourcesContent":["import { networkConnection } from \"./connection\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport BN from \"bn.js\";\nimport {\n  getHandleAndRegistryKey,\n  getHashedName,\n  getNameAccountKey,\n  NameRegistryState,\n  NAME_PROGRAM_ID,\n  getFilteredProgramAccounts,\n} from \"@solana/spl-name-service\";\n\nexport const SolDomainExtention = \"sol\";\n// Address of the SOL TLD\nexport const SOL_TLD_AUTHORITY = new PublicKey(\n  \"58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx\"\n);\n\nexport const PROGRAM_ID = new PublicKey(\n  \"jCebN34bUfdeUYJT13J1yG16XWQpt5PDx6Mse9GUqhR\"\n);\n\nexport async function getAllRegisteredInfo(wallet, twitterOnly = false) {\n  return {\n    twitter: await getTwitterHandle(wallet),\n    domain: twitterOnly ? null : await getUserDomains(wallet),\n  };\n}\nexport async function getTwitterHandle(wallet) {\n  try {\n    const walletKey = new PublicKey(wallet);\n    const reg = await getHandleAndRegistryKey(networkConnection, walletKey);\n\n    if (!reg) return null;\n    return `${reg[0]}`;\n  } catch (e) {\n    // console.log(\"unable to get Twittler handle\");\n  }\n  return null;\n}\nexport async function getUserDomains(wallet) {\n  try {\n    const walletKey = new PublicKey(wallet);\n    const domains = await findOwnedNameAccountsForUser(walletKey);\n    if (!domains || domains.length == 0) return null;\n    // just take the first one\n    const name = await performReverseLookup(networkConnection, domains[0]);\n    if (!name) return null;\n    return `${name}.${SolDomainExtention}`;\n  } catch (e) {\n    // console.log(e);\n    // console.log(\"unable to get domain handle\");\n  }\n  return null;\n}\n\nexport async function performReverseLookup(connection, nameAccount) {\n  let [centralState] = await PublicKey.findProgramAddress(\n    [PROGRAM_ID.toBuffer()],\n    PROGRAM_ID\n  );\n  let hashedReverseLookup = await getHashedName(nameAccount.toBase58());\n  let reverseLookupAccount = await getNameAccountKey(\n    hashedReverseLookup,\n    centralState\n  );\n\n  let name = await NameRegistryState.retrieve(connection, reverseLookupAccount);\n  if (!name.data) {\n    throw new Error(\"Could not retrieve name data\");\n  }\n  let nameLength = new BN(name.data.slice(0, 4), \"le\").toNumber();\n  return name.data.slice(4, 4 + nameLength).toString();\n}\n\nasync function findOwnedNameAccountsForUser(userAccount) {\n  const filters = [\n    {\n      memcmp: {\n        offset: 32,\n        bytes: userAccount.toBase58(),\n      },\n    },\n  ];\n  const accounts = await getFilteredProgramAccounts(\n    networkConnection,\n    NAME_PROGRAM_ID,\n    filters\n  );\n  return accounts.map((a) => a.publicKey);\n}\n"]}]}
{"remainingRequest":"/Users/aaronh/Downloads/abstratica-web/node_modules/babel-loader/lib/index.js!/Users/aaronh/Downloads/abstratica-web/node_modules/eslint-loader/index.js??ref--14-0!/Users/aaronh/Downloads/abstratica-web/src/lib/metadata-helper/metadata.js","dependencies":[{"path":"/Users/aaronh/Downloads/abstratica-web/src/lib/metadata-helper/metadata.js","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/babel.config.js","mtime":1653334282000},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/cache-loader/dist/cjs.js","mtime":1693191335836},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/babel-loader/lib/index.js","mtime":1693191336222},{"path":"/Users/aaronh/Downloads/abstratica-web/node_modules/eslint-loader/index.js","mtime":1693191335906}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiL1VzZXJzL2Fhcm9uaC9Eb3dubG9hZHMvYWJzdHJhdGljYS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZi5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvYWFyb25oL0Rvd25sb2Fkcy9hYnN0cmF0aWNhLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5qc29uLnN0cmluZ2lmeS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgeyBwcm9ncmFtSWRzIH0gZnJvbSAiLi9pZHMuanMiOwppbXBvcnQgeyBQdWJsaWNLZXkgfSBmcm9tICJAc29sYW5hL3dlYjMuanMiOwppbXBvcnQgeyBkZXNlcmlhbGl6ZVVuY2hlY2tlZCB9IGZyb20gImJvcnNoIjsKaW1wb3J0IHsgTUVUQURBVEFfU0NIRU1BLCBNZXRhZGF0YSB9IGZyb20gIi4vZGF0YWxheW91dC5qcyI7CmltcG9ydCB7IG5ldHdvcmtDb25uZWN0aW9uLCBjcmVhdG9yIH0gZnJvbSAiLi4vY29ubmVjdGlvbiI7CmV4cG9ydCB2YXIgTUVUQURBVEFfUFJFRklYID0gIm1ldGFkYXRhIjsKZXhwb3J0IGZ1bmN0aW9uIGdldE5GVE93bmVyKF94KSB7CiAgcmV0dXJuIF9nZXRORlRPd25lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfZ2V0TkZUT3duZXIoKSB7CiAgX2dldE5GVE93bmVyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihtZXRhZGF0YSkgewogICAgdmFyIF9wYXJzZWRBY2NvdW50SW5mbyR2YSwgX3BhcnNlZEFjY291bnRJbmZvJHZhMiwgX3BhcnNlZEFjY291bnRJbmZvJHZhMywgX3BhcnNlZEFjY291bnRJbmZvJHZhNDsKCiAgICB2YXIgX3lpZWxkJGdldE1ldGFkYXRhLCBuYW1lLCB1cmksIG1pbnQsIHN5bWJvbCwgcm95YWx0aWVzLCBob2xkZXJzLCBzcGxBY2NvdW50LCBwYXJzZWRBY2NvdW50SW5mbzsKCiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhZGF0YShuZXR3b3JrQ29ubmVjdGlvbiwgbWV0YWRhdGEpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgX3lpZWxkJGdldE1ldGFkYXRhID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIG5hbWUgPSBfeWllbGQkZ2V0TWV0YWRhdGEubmFtZTsKICAgICAgICAgICAgdXJpID0gX3lpZWxkJGdldE1ldGFkYXRhLnVyaTsKICAgICAgICAgICAgbWludCA9IF95aWVsZCRnZXRNZXRhZGF0YS5taW50OwogICAgICAgICAgICBzeW1ib2wgPSBfeWllbGQkZ2V0TWV0YWRhdGEuc3ltYm9sOwogICAgICAgICAgICByb3lhbHRpZXMgPSBfeWllbGQkZ2V0TWV0YWRhdGEucm95YWx0aWVzOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEwOwogICAgICAgICAgICByZXR1cm4gbmV0d29ya0Nvbm5lY3Rpb24uZ2V0VG9rZW5MYXJnZXN0QWNjb3VudHMobWludCk7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgaG9sZGVycyA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgaWYgKCEoIWhvbGRlcnMgfHwgaG9sZGVycy52YWx1ZS5sZW5ndGggPCAxKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBtaW50Iik7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgc3BsQWNjb3VudCA9IGhvbGRlcnMudmFsdWVbMF0uYWRkcmVzczsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgcmV0dXJuIG5ldHdvcmtDb25uZWN0aW9uLmdldFBhcnNlZEFjY291bnRJbmZvKHNwbEFjY291bnQpOwoKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgIHBhcnNlZEFjY291bnRJbmZvID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgbmZ0T3duZXI6IHBhcnNlZEFjY291bnRJbmZvID09PSBudWxsIHx8IHBhcnNlZEFjY291bnRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3BhcnNlZEFjY291bnRJbmZvJHZhID0gcGFyc2VkQWNjb3VudEluZm8udmFsdWUpID09PSBudWxsIHx8IF9wYXJzZWRBY2NvdW50SW5mbyR2YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9wYXJzZWRBY2NvdW50SW5mbyR2YTIgPSBfcGFyc2VkQWNjb3VudEluZm8kdmEuZGF0YSkgPT09IG51bGwgfHwgX3BhcnNlZEFjY291bnRJbmZvJHZhMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9wYXJzZWRBY2NvdW50SW5mbyR2YTMgPSBfcGFyc2VkQWNjb3VudEluZm8kdmEyLnBhcnNlZCkgPT09IG51bGwgfHwgX3BhcnNlZEFjY291bnRJbmZvJHZhMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9wYXJzZWRBY2NvdW50SW5mbyR2YTQgPSBfcGFyc2VkQWNjb3VudEluZm8kdmEzLmluZm8pID09PSBudWxsIHx8IF9wYXJzZWRBY2NvdW50SW5mbyR2YTQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9wYXJzZWRBY2NvdW50SW5mbyR2YTQub3duZXIsCiAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICB1cmk6IHVyaSwKICAgICAgICAgICAgICBtaW50OiBtaW50LnRvQmFzZTU4KCksCiAgICAgICAgICAgICAgc3ltYm9sOiBzeW1ib2wsCiAgICAgICAgICAgICAgcm95YWx0aWVzOiByb3lhbHRpZXMKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxODoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIpOwogIH0pKTsKICByZXR1cm4gX2dldE5GVE93bmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRNZXRhZGF0YShfeDIsIF94MykgewogIHJldHVybiBfZ2V0TWV0YWRhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX2dldE1ldGFkYXRhKCkgewogIF9nZXRNZXRhZGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoY29ubmVjdGlvbiwgcHVibGljS2V5KSB7CiAgICB2YXIgX2FjY291bnREYXRhJG93bmVyOwoKICAgIHZhciBhY2NvdW50RGF0YSwgZGVjb2RlZDsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHB1YmxpY0tleSA9IF90eXBlb2YocHVibGljS2V5KSA9PSBPYmplY3QgPyBwdWJsaWNLZXkgOiBuZXcgUHVibGljS2V5KHB1YmxpY0tleSk7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24uZ2V0QWNjb3VudEluZm8ocHVibGljS2V5KTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGFjY291bnREYXRhID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICBpZiAoISgoYWNjb3VudERhdGEgPT09IG51bGwgfHwgYWNjb3VudERhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfYWNjb3VudERhdGEkb3duZXIgPSBhY2NvdW50RGF0YS5vd25lcikgPT09IG51bGwgfHwgX2FjY291bnREYXRhJG93bmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYWNjb3VudERhdGEkb3duZXIudG9CYXNlNTgoKSkgIT09IHByb2dyYW1JZHMoKS5tZXRhZGF0YS50b0Jhc2U1OCgpKSkgewogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgZGVjb2RlZCA9IGRlY29kZU1ldGFkYXRhKGFjY291bnREYXRhLmRhdGEpOyAvLyBkbyBub3QgZGlzcGxheSBvdGhlciBORlQKCiAgICAgICAgICAgIGlmICghKGRlY29kZWQudXBkYXRlQXV0aG9yaXR5LnRvQmFzZTU4KCkgIT09IGNyZWF0b3IudG9CYXNlNTgoKSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgbWV0YWRhdGE6IHB1YmxpY0tleSwKICAgICAgICAgICAgICBuYW1lOiBkZWNvZGVkLmRhdGEubmFtZSwKICAgICAgICAgICAgICB1cmk6IGRlY29kZWQuZGF0YS51cmksCiAgICAgICAgICAgICAgbWludDogZGVjb2RlZC5taW50LAogICAgICAgICAgICAgIHN5bWJvbDogZGVjb2RlZC5kYXRhLnN5bWJvbCwKICAgICAgICAgICAgICByb3lhbHRpZXM6IGRlY29kZWQuZGF0YS5zZWxsZXJGZWVCYXNpc1BvaW50cwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMyk7CiAgfSkpOwogIHJldHVybiBfZ2V0TWV0YWRhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdldE1ldGFkYXRhQnlNaW50KF94NCkgewogIHJldHVybiBfZ2V0TWV0YWRhdGFCeU1pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQovKioNCiAqIEdldCBtZXRhZGF0YSBhY2NvdW50IGFkZHJlc3MgZGVyaXZlZCBmcm9tIE1ldGFkYXRhIHByb2dyYW0gYW5kIHRva2VuIG1pbnQgYWRkcmVzcw0KICogQHBhcmFtIHtQdWJsaWNLZXl9IHRva2VuTWludCB0b2tlbiBtaW50IGFkZHJlc3MNCiAqIEByZXR1cm5zIHtQdWJsaWNLZXl9IGRlcml2ZWQgbWV0YWRhdGEgYWNjb3VudCBhZGRyZXNzDQogKi8KCmZ1bmN0aW9uIF9nZXRNZXRhZGF0YUJ5TWludCgpIHsKICBfZ2V0TWV0YWRhdGFCeU1pbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KHRva2VuTWludCkgewogICAgdmFyIG1pbnQ7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBtaW50ID0gdHlwZW9mIHRva2VuTWludCA9PT0gInN0cmluZyIgPyBuZXcgUHVibGljS2V5KHRva2VuTWludCkgOiB0b2tlbk1pbnQ7CiAgICAgICAgICAgIF9jb250ZXh0NC50MCA9IGdldE1ldGFkYXRhOwogICAgICAgICAgICBfY29udGV4dDQudDEgPSBuZXR3b3JrQ29ubmVjdGlvbjsKICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA1OwogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YWRhdGFBY2NvdW50KG1pbnQpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgX2NvbnRleHQ0LnQyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gODsKICAgICAgICAgICAgcmV0dXJuICgwLCBfY29udGV4dDQudDApKF9jb250ZXh0NC50MSwgX2NvbnRleHQ0LnQyKTsKCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDQuc2VudCk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNCk7CiAgfSkpOwogIHJldHVybiBfZ2V0TWV0YWRhdGFCeU1pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gZ2V0TWV0YWRhdGFBY2NvdW50KF94NSkgewogIHJldHVybiBfZ2V0TWV0YWRhdGFBY2NvdW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KLyoqDQogKiBEZWNvZGUgZW5jb2RlZCBtZXRhZGF0YQ0KICogQHBhcmFtIHtCdWZmZXJ9IGJ1ZmZlcg0KICogQHJldHVybnMge01ldGFkYXRhfSBkZWNvZGVkIG1ldGFkYXRhDQogKi8KCgpmdW5jdGlvbiBfZ2V0TWV0YWRhdGFBY2NvdW50KCkgewogIF9nZXRNZXRhZGF0YUFjY291bnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KHRva2VuTWludCkgewogICAgdmFyIFBST0dSQU1fSURTOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgUFJPR1JBTV9JRFMgPSBwcm9ncmFtSWRzKCk7CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGZpbmRQcm9ncmFtQWRkcmVzcyhbQnVmZmVyLmZyb20oTUVUQURBVEFfUFJFRklYKSwgUFJPR1JBTV9JRFMubWV0YWRhdGEudG9CdWZmZXIoKSwgdG9rZW5NaW50LnRvQnVmZmVyKCldLCBQUk9HUkFNX0lEUy5tZXRhZGF0YSk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ1LnNlbnRbMF0pOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTUpOwogIH0pKTsKICByZXR1cm4gX2dldE1ldGFkYXRhQWNjb3VudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpleHBvcnQgdmFyIGRlY29kZU1ldGFkYXRhID0gZnVuY3Rpb24gZGVjb2RlTWV0YWRhdGEoYnVmZmVyKSB7CiAgdmFyIG1ldGFkYXRhID0gZGVzZXJpYWxpemVVbmNoZWNrZWQoTUVUQURBVEFfU0NIRU1BLCBNZXRhZGF0YSwgYnVmZmVyKTsKICByZXR1cm4gbWV0YWRhdGE7Cn07Cgp2YXIgZmluZFByb2dyYW1BZGRyZXNzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShzZWVkcywgcHJvZ3JhbUlkKSB7CiAgICB2YXIga2V5LCBjYWNoZWQsIHZhbHVlLCByZXN1bHQ7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGtleSA9ICJwZGEtIiArIHNlZWRzLnJlZHVjZShmdW5jdGlvbiAoYWdnLCBpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFnZyArIGl0ZW0udG9TdHJpbmcoImhleCIpOwogICAgICAgICAgICB9LCAiIikgKyBwcm9ncmFtSWQudG9TdHJpbmcoKTsKICAgICAgICAgICAgY2FjaGVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTsKCiAgICAgICAgICAgIGlmICghY2FjaGVkKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhbHVlID0gSlNPTi5wYXJzZShjYWNoZWQpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBbbmV3IFB1YmxpY0tleSh2YWx1ZS5rZXkpLCBwYXJzZUludCh2YWx1ZS5ub25jZSldKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICByZXR1cm4gUHVibGljS2V5LmZpbmRQcm9ncmFtQWRkcmVzcyhzZWVkcywgcHJvZ3JhbUlkKTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAga2V5OiByZXN1bHRbMF0udG9CYXNlNTgoKSwKICAgICAgICAgICAgICAgIG5vbmNlOiByZXN1bHRbMV0KICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKF91bnVzZWQpIHsvLyBpZ25vcmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzdWx0KTsKCiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGZpbmRQcm9ncmFtQWRkcmVzcyhfeDYsIF94NykgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7"},{"version":3,"sources":["/Users/aaronh/Downloads/abstratica-web/src/lib/metadata-helper/metadata.js"],"names":["programIds","PublicKey","deserializeUnchecked","METADATA_SCHEMA","Metadata","networkConnection","creator","METADATA_PREFIX","getNFTOwner","metadata","getMetadata","name","uri","mint","symbol","royalties","getTokenLargestAccounts","holders","value","length","Error","splAccount","address","getParsedAccountInfo","parsedAccountInfo","nftOwner","data","parsed","info","owner","toBase58","connection","publicKey","Object","getAccountInfo","accountData","decoded","decodeMetadata","updateAuthority","sellerFeeBasisPoints","getMetadataByMint","tokenMint","getMetadataAccount","PROGRAM_IDS","findProgramAddress","Buffer","from","toBuffer","buffer","seeds","programId","key","reduce","agg","item","toString","cached","localStorage","getItem","JSON","parse","parseInt","nonce","result","setItem","stringify"],"mappings":"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","sourcesContent":["import { programIds } from \"./ids.js\";\r\nimport { PublicKey } from \"@solana/web3.js\";\r\nimport { deserializeUnchecked } from \"borsh\";\r\nimport { METADATA_SCHEMA, Metadata } from \"./datalayout.js\";\r\nimport { networkConnection, creator } from \"../connection\";\r\n\r\nexport const METADATA_PREFIX = \"metadata\";\r\n\r\nexport async function getNFTOwner(metadata) {\r\n  const { name, uri, mint, symbol, royalties } = await getMetadata(\r\n    networkConnection,\r\n    metadata\r\n  );\r\n\r\n  const holders = await networkConnection.getTokenLargestAccounts(mint);\r\n  if (!holders || holders.value.length < 1) {\r\n    throw new Error(\"invalid mint\");\r\n  }\r\n  const { address: splAccount } = holders.value[0];\r\n\r\n  const parsedAccountInfo = await networkConnection.getParsedAccountInfo(\r\n    splAccount\r\n  );\r\n  return {\r\n    nftOwner: parsedAccountInfo?.value?.data?.parsed?.info?.owner,\r\n    name,\r\n    uri,\r\n    mint: mint.toBase58(),\r\n    symbol,\r\n    royalties: royalties,\r\n  };\r\n}\r\n\r\nexport async function getMetadata(connection, publicKey) {\r\n  publicKey = typeof publicKey == Object ? publicKey : new PublicKey(publicKey);\r\n  const accountData = await connection.getAccountInfo(publicKey);\r\n  if (accountData?.owner?.toBase58() !== programIds().metadata.toBase58())\r\n    // throw new Error(\"Account is not owned by Metadata program\");\r\n    return null;\r\n\r\n  const decoded = decodeMetadata(accountData.data);\r\n  // do not display other NFT\r\n  if (decoded.updateAuthority.toBase58() !== creator.toBase58()) return null;\r\n  return {\r\n    metadata: publicKey,\r\n    name: decoded.data.name,\r\n    uri: decoded.data.uri,\r\n    mint: decoded.mint,\r\n    symbol: decoded.data.symbol,\r\n    royalties: decoded.data.sellerFeeBasisPoints,\r\n  };\r\n}\r\n\r\nexport async function getMetadataByMint(tokenMint) {\r\n  const mint =\r\n    typeof tokenMint === \"string\" ? new PublicKey(tokenMint) : tokenMint;\r\n\r\n  return await getMetadata(networkConnection, await getMetadataAccount(mint));\r\n}\r\n\r\n/**\r\n * Get metadata account address derived from Metadata program and token mint address\r\n * @param {PublicKey} tokenMint token mint address\r\n * @returns {PublicKey} derived metadata account address\r\n */\r\nasync function getMetadataAccount(tokenMint) {\r\n  const PROGRAM_IDS = programIds();\r\n\r\n  return (\r\n    await findProgramAddress(\r\n      [\r\n        Buffer.from(METADATA_PREFIX),\r\n        PROGRAM_IDS.metadata.toBuffer(),\r\n        tokenMint.toBuffer(),\r\n      ],\r\n      PROGRAM_IDS.metadata\r\n    )\r\n  )[0];\r\n}\r\n\r\n/**\r\n * Decode encoded metadata\r\n * @param {Buffer} buffer\r\n * @returns {Metadata} decoded metadata\r\n */\r\nexport const decodeMetadata = (buffer) => {\r\n  const metadata = deserializeUnchecked(METADATA_SCHEMA, Metadata, buffer);\r\n  return metadata;\r\n};\r\n\r\nconst findProgramAddress = async (seeds, programId) => {\r\n  const key =\r\n    \"pda-\" +\r\n    seeds.reduce((agg, item) => agg + item.toString(\"hex\"), \"\") +\r\n    programId.toString();\r\n  let cached = localStorage.getItem(key);\r\n  if (cached) {\r\n    const value = JSON.parse(cached);\r\n\r\n    return [new PublicKey(value.key), parseInt(value.nonce)];\r\n  }\r\n\r\n  const result = await PublicKey.findProgramAddress(seeds, programId);\r\n\r\n  try {\r\n    localStorage.setItem(\r\n      key,\r\n      JSON.stringify({\r\n        key: result[0].toBase58(),\r\n        nonce: result[1],\r\n      })\r\n    );\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  return result;\r\n};\r\n"]}]}